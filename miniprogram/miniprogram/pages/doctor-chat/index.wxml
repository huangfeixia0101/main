<view class="chat-container">
  <view class="chat-header">
    <text class="title">ğŸ©º æ™ºèƒ½åŒ»ç”ŸåŒ¹é…</text>
    <text class="subtitle">âœ¨ æè¿°æ‚¨çš„éœ€æ±‚ï¼ŒAIä¸ºæ‚¨åŒ¹é…æœ€åˆé€‚çš„åŒ»ç”Ÿ</text>
  </view>
  
  <scroll-view class="chat-messages" scroll-y="{{true}}" scroll-top="{{scrollTop}}">
    <view wx:for="{{messages}}" wx:key="index" class="message-item">
      <view class="message {{item.role === 'user' ? 'user-message' : 'ai-message'}}">
        <text>{{item.content}}</text>
      </view>
      
      <!-- åŒ»ç”ŸåŒ¹é…å¡ç‰‡ -->
      <view wx:if="{{item.doctors && item.doctors.length > 0}}" class="doctor-recommendations">
        <text class="recommendations-title">ğŸ¯ ä¸ºæ‚¨åŒ¹é…ä»¥ä¸‹åŒ»ç”Ÿ</text>
        <view wx:for="{{item.doctors}}" wx:for-item="doctor" wx:key="_id" 
              class="doctor-card" bindtap="selectDoctor" data-doctor="{{doctor}}">
          <view class="doctor-info">
            <view class="doctor-header">
              <text class="doctor-name">{{doctor.name}} {{doctor.title}}</text>
              <view class="doctor-badge">åŒ¹é…</view>
            </view>
            <text class="doctor-hospital">ğŸ¥ {{doctor.hospital}} Â· {{doctor.department}}</text>
            <text class="doctor-specialty">ğŸ”¬ æ“…é•¿ï¼š{{doctor.specialties}}</text>
            <text class="recommend-reason"> åŒ¹é…ç†ç”±ï¼š{{doctor.recommendReason}}</text>
            <text wx:if="{{doctor.study_report}}" class="study-report">ğŸ“Š ç ”ç©¶æŠ¥å‘Šï¼š{{doctor.study_report}}</text>
            <view class="doctor-meta">
              <view class="rating">{{doctor.rating}}</view>
              <view class="match-score">{{doctor.matchScore}}%</view>
            </view>

            

          </view>
          <view class="card-action">
            <text class="action-text">ä»£åŠé¢„çº¦</text>
            <text class="action-arrow">â†’</text>
          </view>
        </view>
      </view>
      
      <!-- æœåŠ¡åŒ¹é…å¡ç‰‡ -->
      <view wx:if="{{item.doctors && item.doctors.length === 0}}" class="service-recommendations">
        <text class="recommendations-title">ğŸ¯ ä¸ºæ‚¨åŒ¹é…åŒ»ç”ŸæœåŠ¡</text>
        <view class="service-card" bindtap="selectService">
          <view class="service-info">
            <view class="service-header">
              <text class="service-name">{{item.recommendedService.serviceName}}</text>
              <view class="service-badge">åŒ¹é…</view>
            </view>
            <text class="service-description">ğŸ” ä¸“ä¸šçš„åŒ»ç”ŸåŒ¹é…æœåŠ¡ï¼Œä¸ºæ‚¨ç²¾å‡†åŒ¹é…åˆé€‚çš„åŒ»ç”Ÿ</text>
            <text class="service-reason">ğŸ’¡ åŒ¹é…ç†ç”±ï¼šæ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œä¸ºæ‚¨è¿›è¡Œä¸“å±çš„åŒ»ç”ŸåŒ¹é…è°ƒç ”</text>
          </view>
          <view class="card-action">
            <text class="action-text">ç‚¹å‡»ä½¿ç”¨</text>
            <text class="action-arrow">â†’</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-message">
      <view class="loading-content">
        <view class="loading-spinner"></view>
        <text class="loading-text">{{loadingStatus}}</text>
        <!-- è¿›åº¦æ¡ -->
        <view wx:if="{{showProgress}}" class="progress-container">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{progressPercent}}%"></view>
          </view>
          <text class="progress-text">{{progressPercent}}%</text>
        </view>
        <!-- å€’è®¡æ—¶æ˜¾ç¤º -->
        <view wx:if="{{showCountdown}}" class="countdown-container">
          <view class="countdown-circle">
            <text class="countdown-number">{{countdown}}</text>
          </view>
          <text class="countdown-text">ç§’åå®Œæˆ(é¢„ä¼°)</text>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <view class="chat-input">
    <input class="input-field" placeholder="ğŸ’¬ è¯·æè¿°æ‚¨çš„è¯‰æ±‚..." 
           value="{{inputText}}" bindinput="onInput" confirm-type="send" bindconfirm="sendMessage"/>
    <button class="send-btn" bindtap="sendMessage" disabled="{{!inputText || loading}}">
      {{loading ? 'â³ åˆ†æä¸­...' : 'ğŸš€ å‘é€'}}
    </button>
  </view>
</view>