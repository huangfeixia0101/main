<!--ç§¯åˆ†å†å²è¯¦æƒ…é¡µé¢-->
<view class="history-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ç§¯åˆ†è®°å½•</text>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{filterType === 'all' ? 'active' : ''}}" bindtap="setFilter" data-type="all">
        å…¨éƒ¨
      </view>
      <view class="filter-tab {{filterType === 'earn' ? 'active' : ''}}" bindtap="setFilter" data-type="earn">
        è·å¾—
      </view>
      <view class="filter-tab {{filterType === 'spend' ? 'active' : ''}}" bindtap="setFilter" data-type="spend">
        æ¶ˆè´¹
      </view>
    </view>
  </view>

  <!-- ç§¯åˆ†å†å²åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{filteredHistory.length > 0}}">
    <view class="history-item" wx:for="{{filteredHistory}}" wx:key="_id">
      <view class="history-left">
        <view class="history-icon {{item.type}}">
          <text wx:if="{{item.type === 'earn'}}">ğŸ“ˆ</text>
          <text wx:else>ğŸ“‰</text>
        </view>
        <view class="history-info">
          <text class="history-desc">{{item.description}}</text>
          <text class="history-source" wx:if="{{item.source}}">æ¥æºï¼š{{getSourceName(item.source)}}</text>
          <text class="history-time">{{item.createTime}}</text>
        </view>
      </view>
      <view class="history-right">
        <view class="history-points {{item.type}}">
          {{item.type === 'earn' ? '+' : '-'}}{{item.points}}
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <image class="empty-icon" src="/images/empty-points.png" mode="aspectFit"></image>
    <text class="empty-text">æš‚æ— ç§¯åˆ†è®°å½•</text>
    <text class="empty-desc">å¿«å»åˆ†äº«å°ç¨‹åºæˆ–é‚€è¯·å¥½å‹è·å–ç§¯åˆ†å§ï¼</text>
    <button class="go-earn-btn" bindtap="goToPoints">å»èµšç§¯åˆ†</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && filteredHistory.length > 0}}">
    <button class="load-more-btn" bindtap="loadMore" loading="{{loading}}">
      {{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
    </button>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!hasMore && filteredHistory.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
  </view>
</view>